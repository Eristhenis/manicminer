<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Manic Miner: Routine at 34252</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="34188.html">34188</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#34252">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="34436.html">34436</a></span></td>
</tr>
</table>
<div class="description">34252: Display the title screen and play the theme tune</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a class="link" href="33792.html">33792</a>, <a class="link" href="34574.html">34574</a> and <a class="link" href="35140.html">35140</a>.
</div>
<div class="paragraph">
The first thing this routine does is initialise some game status buffer variables in preparation for the next game.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="34252"></a>34252</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34253"></a>34253</td>
<td class="instruction">LD (33799),A</td>
<td class="comment-11" rowspan="1">Initialise the current cavern number at <a class="link" href="33799.html">33799</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34256"></a>34256</td>
<td class="instruction">LD (33881),A</td>
<td class="comment-11" rowspan="1">Initialise the Kempston joystick indicator at <a class="link" href="33881.html">33881</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34259"></a>34259</td>
<td class="instruction">LD (33882),A</td>
<td class="comment-11" rowspan="1">Initialise the game mode indicator at <a class="link" href="33882.html">33882</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34262"></a>34262</td>
<td class="instruction">LD (33883),A</td>
<td class="comment-11" rowspan="1">Initialise the in-game music note index at <a class="link" href="33883.html">33883</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34265"></a>34265</td>
<td class="instruction">LD (33880),A</td>
<td class="comment-11" rowspan="1">Initialise the screen flash counter at <a class="link" href="33880.html">33880</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34268"></a>34268</td>
<td class="instruction">LD A,2</td>
<td class="comment-11" rowspan="2">Initialise the number of lives remaining at <a class="link" href="33879.html">33879</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34270"></a>34270</td>
<td class="instruction">LD (33879),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34273"></a>34273</td>
<td class="instruction">LD HL,33884</td>
<td class="comment-11" rowspan="2">Initialise the keypress flag in bit 0 at <a class="link" href="33884.html">33884</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34276"></a>34276</td>
<td class="instruction">SET 0,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="34278"></a>
<div class="comments">
<div class="paragraph">
Next, prepare the screen.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34278"></a>34278</td>
<td class="instruction">LD HL,16384</td>
<td class="comment-11" rowspan="5">Clear the entire display file</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34281"></a>34281</td>
<td class="instruction">LD DE,16385</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34284"></a>34284</td>
<td class="instruction">LD BC,6143</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34287"></a>34287</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34289"></a>34289</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34291"></a>34291</td>
<td class="instruction">LD HL,40960</td>
<td class="comment-11" rowspan="4">Copy the graphic data at <a class="link" href="40960.html">40960</a> to the top two-thirds of the display file</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34294"></a>34294</td>
<td class="instruction">LD DE,16384</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34297"></a>34297</td>
<td class="instruction">LD BC,4096</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34300"></a>34300</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34302"></a>34302</td>
<td class="instruction">LD HL,18493</td>
<td class="comment-11" rowspan="4">Draw Willy at (9,29)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34305"></a>34305</td>
<td class="instruction">LD DE,33344</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34308"></a>34308</td>
<td class="instruction">LD C,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34310"></a>34310</td>
<td class="instruction">CALL <a class="link" href="36852.html">36852</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34313"></a>34313</td>
<td class="instruction">LD HL,64512</td>
<td class="comment-11" rowspan="4">Copy the attribute bytes from <a class="link" href="64512.html">64512</a> to the top third of the attribute file</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34316"></a>34316</td>
<td class="instruction">LD DE,22528</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34319"></a>34319</td>
<td class="instruction">LD BC,256</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34322"></a>34322</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34324"></a>34324</td>
<td class="instruction">LD HL,40448</td>
<td class="comment-11" rowspan="3">Copy the attribute bytes from <a class="link" href="40448.html">40448</a> to the bottom two-thirds of the attribute file</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34327"></a>34327</td>
<td class="instruction">LD BC,512</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34330"></a>34330</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="34332"></a>
<div class="comments">
<div class="paragraph">
Now check whether there is a joystick connected.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34332"></a>34332</td>
<td class="instruction">LD BC,31</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=0, <span class="register">C</span>=31 (joystick port)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34335"></a>34335</td>
<td class="instruction">DI</td>
<td class="comment-11" rowspan="1">Disable interrupts (which are already disabled)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34336"></a>34336</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="34337"></a>34337</td>
<td class="instruction">IN E,(C)</td>
<td class="comment-11" rowspan="3">Combine 256 readings of the joystick port in <span class="register">A</span>; if no joystick is connected, some of these readings will have bit 5 set</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34339"></a>34339</td>
<td class="instruction">OR E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34340"></a>34340</td>
<td class="instruction">DJNZ <a class="link" href="34252.html#34337">34337</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34342"></a>34342</td>
<td class="instruction">AND 32</td>
<td class="comment-11" rowspan="1">Is a joystick connected (bit 5 reset)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34344"></a>34344</td>
<td class="instruction">JR NZ,<a class="link" href="34252.html#34351">34351</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34346"></a>34346</td>
<td class="instruction">LD A,1</td>
<td class="comment-11" rowspan="2">Set the Kempston joystick indicator at <a class="link" href="33881.html">33881</a> to 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34348"></a>34348</td>
<td class="instruction">LD (33881),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="34351"></a>
<div class="comments">
<div class="paragraph">
And finally, play the theme tune and check for keypresses.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="34351"></a>34351</td>
<td class="instruction">LD IY,33902</td>
<td class="comment-11" rowspan="1">Point <span class="register">IY</span> at the theme tune data at <a class="link" href="33902.html">33902</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34355"></a>34355</td>
<td class="instruction">CALL <a class="link" href="37596.html">37596</a></td>
<td class="comment-11" rowspan="1">Play the theme tune</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34358"></a>34358</td>
<td class="instruction">JP NZ,<a class="link" href="34436.html">34436</a></td>
<td class="comment-11" rowspan="1">Start the game if ENTER or the fire button was pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34361"></a>34361</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Initialise the game status buffer variable at <a class="link" href="32988.html">32988</a>; this will be used as an index for the message scrolled across the screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34362"></a>34362</td>
<td class="instruction">LD (32988),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="34365"></a>34365</td>
<td class="instruction">LD A,(32988)</td>
<td class="comment-11" rowspan="1">Pick up the message index from <a class="link" href="32988.html">32988</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34368"></a>34368</td>
<td class="instruction">LD IX,40192</td>
<td class="comment-11" rowspan="2">Point <span class="register">IX</span> at the corresponding location in the message at <a class="link" href="40192.html">40192</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34372"></a>34372</td>
<td class="instruction">LD IXl,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34374"></a>34374</td>
<td class="instruction">LD DE,20576</td>
<td class="comment-11" rowspan="3">Print 32 characters of the message at (19,0)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34377"></a>34377</td>
<td class="instruction">LD C,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34379"></a>34379</td>
<td class="instruction">CALL <a class="link" href="37562.html">37562</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34382"></a>34382</td>
<td class="instruction">LD A,(32988)</td>
<td class="comment-11" rowspan="1">Pick up the message index from <a class="link" href="32988.html">32988</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34385"></a>34385</td>
<td class="instruction">AND 6</td>
<td class="comment-11" rowspan="4">Keep only bits 1 and 2, and move them into bits 6 and 7, so that <span class="register">A</span> holds 0, 64, 128 or 192; this value determines the animation frame to use for Willy</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34387"></a>34387</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34388"></a>34388</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34389"></a>34389</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34390"></a>34390</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="2">Point <span class="register">DE</span> at the graphic data for Willy's sprite (<a class="link" href="33280.html">33280</a>+<span class="register">A</span>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34391"></a>34391</td>
<td class="instruction">LD D,130</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34393"></a>34393</td>
<td class="instruction">LD HL,18493</td>
<td class="comment-11" rowspan="3">Draw Willy at (9,29)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34396"></a>34396</td>
<td class="instruction">LD C,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34398"></a>34398</td>
<td class="instruction">CALL <a class="link" href="36852.html">36852</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34401"></a>34401</td>
<td class="instruction">LD BC,100</td>
<td class="comment-11" rowspan="4">Pause for about 0.1s</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="34404"></a>34404</td>
<td class="instruction">DJNZ <a class="link" href="34252.html#34404">34404</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34406"></a>34406</td>
<td class="instruction">DEC C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34407"></a>34407</td>
<td class="instruction">JR NZ,<a class="link" href="34252.html#34404">34404</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34409"></a>34409</td>
<td class="instruction">LD BC,49150</td>
<td class="comment-11" rowspan="2">Read keys H-J-K-L-ENTER</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34412"></a>34412</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34414"></a>34414</td>
<td class="instruction">AND 1</td>
<td class="comment-11" rowspan="1">Keep only bit 0 of the result (ENTER)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34416"></a>34416</td>
<td class="instruction">CP 1</td>
<td class="comment-11" rowspan="1">Is ENTER being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34418"></a>34418</td>
<td class="instruction">JR NZ,<a class="link" href="34436.html">34436</a></td>
<td class="comment-11" rowspan="1">If so, start the game</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34420"></a>34420</td>
<td class="instruction">LD A,(32988)</td>
<td class="comment-11" rowspan="1">Pick up the message index from <a class="link" href="32988.html">32988</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34423"></a>34423</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1">Increment it</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34424"></a>34424</td>
<td class="instruction">CP 224</td>
<td class="comment-11" rowspan="1">Set the zero flag if we've reached the end of the message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34426"></a>34426</td>
<td class="instruction">LD (32988),A</td>
<td class="comment-11" rowspan="1">Store the new message index at <a class="link" href="32988.html">32988</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34429"></a>34429</td>
<td class="instruction">JR NZ,<a class="link" href="34252.html#34365">34365</a></td>
<td class="comment-11" rowspan="1">Jump back unless we've finished scrolling the message across the screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34431"></a>34431</td>
<td class="instruction">LD A,64</td>
<td class="comment-11" rowspan="2">Initialise the game mode indicator at <a class="link" href="33882.html">33882</a> to 64: demo mode</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34433"></a>34433</td>
<td class="instruction">LD (33882),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">

<div class="comments">
<div class="paragraph">
This routine continues into the one at <a class="link" href="34436.html">34436</a>.
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="34188.html">34188</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#34252">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="34436.html">34436</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Manic Miner RAM disassembly 20141114</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd (Manic Miner). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.1.1.</div>
</div>
</body>
</html>