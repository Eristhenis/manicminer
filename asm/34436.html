<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Manic Miner: Routine at 34436</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="34252.html">34252</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#34436">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="34574.html">34574</a></span></td>
</tr>
</table>
<div class="description">34436: Start the game (or demo mode)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="34252.html">34252</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="34436"></a>34436</td>
<td class="instruction">LD HL,33829</td>
<td class="comment-11" rowspan="5">Initialise the score at <a class="link" href="33829.html">33829</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34439"></a>34439</td>
<td class="instruction">LD DE,33830</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34442"></a>34442</td>
<td class="instruction">LD BC,9</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34445"></a>34445</td>
<td class="instruction">LD (HL),48</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34447"></a>34447</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="34449"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a class="link" href="34574.html">34574</a> (when teleporting into a cavern or reinitialising the current cavern after Willy has lost a life) and <a class="link" href="36904.html">36904</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="34449"></a>34449</td>
<td class="instruction">LD A,(33799)</td>
<td class="comment-11" rowspan="1">Pick up the number of the current cavern from <a class="link" href="33799.html">33799</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34452"></a>34452</td>
<td class="instruction">SLA A</td>
<td class="comment-11" rowspan="5">Point <span class="register">HL</span> at the first byte of the cavern definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34454"></a>34454</td>
<td class="instruction">SLA A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34456"></a>34456</td>
<td class="instruction">ADD A,176</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34458"></a>34458</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34459"></a>34459</td>
<td class="instruction">LD L,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34461"></a>34461</td>
<td class="instruction">LD DE,24064</td>
<td class="comment-11" rowspan="3">Copy the cavern's attribute bytes into the buffer at <a class="link" href="24064.html">24064</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34464"></a>34464</td>
<td class="instruction">LD BC,512</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34467"></a>34467</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34469"></a>34469</td>
<td class="instruction">LD DE,32768</td>
<td class="comment-11" rowspan="3">Copy the rest of the cavern definition into the game status buffer at <a class="link" href="../buffers/gbuffer.html#32768">32768-33279</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34472"></a>34472</td>
<td class="instruction">LD BC,512</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34475"></a>34475</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34477"></a>34477</td>
<td class="instruction">CALL <a class="link" href="35445.html">35445</a></td>
<td class="comment-11" rowspan="1">Draw the current cavern to the screen buffer at <a class="link" href="28672.html">28672</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34480"></a>34480</td>
<td class="instruction">LD HL,20480</td>
<td class="comment-11" rowspan="5">Clear the bottom third of the display file</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34483"></a>34483</td>
<td class="instruction">LD DE,20481</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34486"></a>34486</td>
<td class="instruction">LD BC,2047</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34489"></a>34489</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34491"></a>34491</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34493"></a>34493</td>
<td class="instruction">LD IX,32768</td>
<td class="comment-11" rowspan="4">Print the cavern name (see <a class="link" href="32768.html">32768</a>) at (16,0)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34497"></a>34497</td>
<td class="instruction">LD C,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34499"></a>34499</td>
<td class="instruction">LD DE,20480</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34502"></a>34502</td>
<td class="instruction">CALL <a class="link" href="37562.html">37562</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34505"></a>34505</td>
<td class="instruction">LD IX,33816</td>
<td class="comment-11" rowspan="4">Print 'AIR' (see <a class="link" href="33816.html">33816</a>) at (17,0)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34509"></a>34509</td>
<td class="instruction">LD C,3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34511"></a>34511</td>
<td class="instruction">LD DE,20512</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34514"></a>34514</td>
<td class="instruction">CALL <a class="link" href="37562.html">37562</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34517"></a>34517</td>
<td class="instruction">LD A,82</td>
<td class="comment-11" rowspan="1">Initialise <span class="register">A</span> to 82; this is the MSB of the display file address at which to start drawing the bar that represents the air supply</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="34519"></a>34519</td>
<td class="instruction">LD H,A</td>
<td class="comment-11" rowspan="4">Prepare <span class="register">HL</span> and <span class="register">DE</span> for drawing a row of pixels in the air bar</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34520"></a>34520</td>
<td class="instruction">LD D,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34521"></a>34521</td>
<td class="instruction">LD L,36</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34523"></a>34523</td>
<td class="instruction">LD E,37</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34525"></a>34525</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1">Save the display file address MSB in <span class="register">B</span> briefly</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34526"></a>34526</td>
<td class="instruction">LD A,(32956)</td>
<td class="comment-11" rowspan="1">Pick up the value of the initial air supply from <a class="link" href="32956.html">32956</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34529"></a>34529</td>
<td class="instruction">SUB 36</td>
<td class="comment-11" rowspan="2">Now <span class="register">C</span> determines the length of the air bar (in cell widths)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34531"></a>34531</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34532"></a>34532</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="1">Restore the display file address MSB to <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34533"></a>34533</td>
<td class="instruction">LD B,0</td>
<td class="comment-11" rowspan="1">Now <span class="register">BC</span> determines the length of the air bar (in cell widths)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34535"></a>34535</td>
<td class="instruction">LD (HL),255</td>
<td class="comment-11" rowspan="2">Draw a single row of pixels across <span class="register">C</span> cells</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34537"></a>34537</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34539"></a>34539</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1">Increment the display file address MSB in <span class="register">A</span> (moving down to the next row of pixels)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34540"></a>34540</td>
<td class="instruction">CP 86</td>
<td class="comment-11" rowspan="1">Have we drawn all four rows of pixels in the air bar yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34542"></a>34542</td>
<td class="instruction">JR NZ,<a class="link" href="34436.html#34519">34519</a></td>
<td class="comment-11" rowspan="1">If not, jump back to draw the next one</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34544"></a>34544</td>
<td class="instruction">LD IX,33839</td>
<td class="comment-11" rowspan="4">Print 'High Score 000000&#160;&#160;&#160;Score 000000' (see <a class="link" href="33839.html">33839</a>) at (19,0)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34548"></a>34548</td>
<td class="instruction">LD DE,20576</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34551"></a>34551</td>
<td class="instruction">LD C,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34553"></a>34553</td>
<td class="instruction">CALL <a class="link" href="37562.html">37562</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34556"></a>34556</td>
<td class="instruction">LD A,(32883)</td>
<td class="comment-11" rowspan="1">Pick up the border colour for the current cavern from <a class="link" href="32883.html">32883</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34559"></a>34559</td>
<td class="instruction">LD C,254</td>
<td class="comment-11" rowspan="2">Set the border colour</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34561"></a>34561</td>
<td class="instruction">OUT (C),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34563"></a>34563</td>
<td class="instruction">LD A,(33882)</td>
<td class="comment-11" rowspan="1">Pick up the game mode indicator from <a class="link" href="33882.html">33882</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34566"></a>34566</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Are we in demo mode?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34567"></a>34567</td>
<td class="instruction">JR Z,<a class="link" href="34574.html">34574</a></td>
<td class="comment-11" rowspan="1">If not, enter the main loop now</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34569"></a>34569</td>
<td class="instruction">LD A,64</td>
<td class="comment-11" rowspan="2">Reset the game mode indicator at <a class="link" href="33882.html">33882</a> to 64 (we're in demo mode)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="34571"></a>34571</td>
<td class="instruction">LD (33882),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">

<div class="comments">
<div class="paragraph">
This routine continues into the main loop at <a class="link" href="34574.html">34574</a>.
</div>
</div>
</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="34252.html">34252</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#34436">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="34574.html">34574</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Manic Miner RAM disassembly 20141114</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd (Manic Miner). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.1.1.</div>
</div>
</body>
</html>