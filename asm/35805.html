<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Manic Miner: Routine at 35805</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Manic Miner" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="35770.html">35770</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#35805">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="36101.html">36101</a></span></td>
</tr>
</table>
<div class="description">35805: Move Willy (2)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="35515.html">35515</a>. This routine checks the keyboard and joystick, and moves Willy left or right if necessary.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Attribute buffer address of the left-hand cell below Willy's sprite</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35805"></a>35805</td>
<td class="instruction">LD A,(32875)</td>
<td class="comment-11" rowspan="1">Pick up the airborne status indicator from <a class="link" href="32875.html">32875</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35808"></a>35808</td>
<td class="instruction">CP 12</td>
<td class="comment-11" rowspan="1">Has Willy just landed after falling from too great a height?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35810"></a>35810</td>
<td class="instruction">JP NC,<a class="link" href="36101.html#36102">36102</a></td>
<td class="comment-11" rowspan="1">If so, kill him</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35813"></a>35813</td>
<td class="instruction">LD E,255</td>
<td class="comment-11" rowspan="1">Initialise <span class="register">E</span> to 255 (all bits set); it will be used to hold keyboard and joystick readings</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35815"></a>35815</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Reset the airborne status indicator at <a class="link" href="32875.html">32875</a> (Willy has landed safely)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35816"></a>35816</td>
<td class="instruction">LD (32875),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35819"></a>35819</td>
<td class="instruction">LD A,(32836)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the conveyor tile for the current cavern from <a class="link" href="32800.html#32836">32836</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35822"></a>35822</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Does the attribute byte of the left-hand cell below Willy's sprite match that of the conveyor tile?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35823"></a>35823</td>
<td class="instruction">JR Z,<a class="link" href="35805.html#35829">35829</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35825"></a>35825</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the right-hand cell below Willy's sprite</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35826"></a>35826</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Does the attribute byte of the right-hand cell below Willy's sprite match that of the conveyor tile?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35827"></a>35827</td>
<td class="instruction">JR NZ,<a class="link" href="35805.html#35835">35835</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35829"></a>35829</td>
<td class="instruction">LD A,(32879)</td>
<td class="comment-11" rowspan="1">Pick up the direction byte of the conveyor definition from <a class="link" href="32879.html">32879</a> (0=left, 1=right)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35832"></a>35832</td>
<td class="instruction">SUB 3</td>
<td class="comment-11" rowspan="2">Now <span class="register">E</span>=253 (bit 1 reset) if the conveyor is moving left, or 254 (bit 0 reset) if it's moving right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35834"></a>35834</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35835"></a>35835</td>
<td class="instruction">LD BC,57342</td>
<td class="comment-11" rowspan="2">Read keys P-O-I-U-Y (right, left, right, left, right) into bits 0-4 of <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35838"></a>35838</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35840"></a>35840</td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="2">Set bit 5 and reset bits 6 and 7</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35842"></a>35842</td>
<td class="instruction">OR 32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35844"></a>35844</td>
<td class="instruction">AND E</td>
<td class="comment-11" rowspan="1">Reset bit 0 if the conveyor is moving right, or bit 1 if it's moving left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35845"></a>35845</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1">Save the result in <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35846"></a>35846</td>
<td class="instruction">LD BC,64510</td>
<td class="comment-11" rowspan="2">Read keys Q-W-E-R-T (left, right, left, right, left) into bits 0-4 of <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35849"></a>35849</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35851"></a>35851</td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="3">Keep only bits 0-4, shift them into bits 1-5, and set bit 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35853"></a>35853</td>
<td class="instruction">RLC A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35855"></a>35855</td>
<td class="instruction">OR 1</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35857"></a>35857</td>
<td class="instruction">AND E</td>
<td class="comment-11" rowspan="2">Merge this keyboard reading into bits 1-5 of <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35858"></a>35858</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35859"></a>35859</td>
<td class="instruction">LD B,247</td>
<td class="comment-11" rowspan="2">Read keys 1-2-3-4-5 ('5' is left) into bits 0-4 of <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35861"></a>35861</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35863"></a>35863</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="2">Rotate the result right and set bits 0-2 and 4-7; this ignores every key except '5' (left)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35864"></a>35864</td>
<td class="instruction">OR 247</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35866"></a>35866</td>
<td class="instruction">AND E</td>
<td class="comment-11" rowspan="2">Merge this reading of the '5' key into bit 3 of <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35867"></a>35867</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35868"></a>35868</td>
<td class="instruction">LD B,239</td>
<td class="comment-11" rowspan="2">Read keys 0-9-8-7-6 ('8' is right) into bits 0-4 of <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35870"></a>35870</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35872"></a>35872</td>
<td class="instruction">OR 251</td>
<td class="comment-11" rowspan="1">Set bits 0, 1 and 3-7; this ignores every key except '8' (right)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35874"></a>35874</td>
<td class="instruction">AND E</td>
<td class="comment-11" rowspan="2">Merge this reading of the '8' key into bit 2 of <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35875"></a>35875</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35876"></a>35876</td>
<td class="instruction">LD A,(33881)</td>
<td class="comment-11" rowspan="1">Collect the Kempston joystick indicator from <a class="link" href="33881.html">33881</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35879"></a>35879</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Is the joystick connected?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35880"></a>35880</td>
<td class="instruction">JR Z,<a class="link" href="35805.html#35892">35892</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35882"></a>35882</td>
<td class="instruction">LD BC,31</td>
<td class="comment-11" rowspan="2">Collect input from the joystick</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35885"></a>35885</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35887"></a>35887</td>
<td class="instruction">AND 3</td>
<td class="comment-11" rowspan="2">Keep only bits 0 (right) and 1 (left) and flip them</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35889"></a>35889</td>
<td class="instruction">CPL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35890"></a>35890</td>
<td class="instruction">AND E</td>
<td class="comment-11" rowspan="2">Merge this reading of the joystick right and left buttons into bits 0 and 1 of <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35891"></a>35891</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="35892"></a>
<div class="comments">
<div class="paragraph">
At this point, bits 0-5 in <span class="register">E</span> indicate the direction in which Willy is being moved or trying to move. If bit 0, 2 or 4 is reset, Willy is being moved or trying to move right; if bit 1, 3 or 5 is reset, Willy is being moved or trying to move left.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35892"></a>35892</td>
<td class="instruction">LD C,0</td>
<td class="comment-11" rowspan="1">Initialise <span class="register">C</span> to 0 (no movement)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35894"></a>35894</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1">Copy the movement bits into <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35895"></a>35895</td>
<td class="instruction">AND 42</td>
<td class="comment-11" rowspan="1">Keep only bits 1, 3 and 5 (the 'left' bits)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35897"></a>35897</td>
<td class="instruction">CP 42</td>
<td class="comment-11" rowspan="1">Are any of these bits reset?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35899"></a>35899</td>
<td class="instruction">JR Z,<a class="link" href="35805.html#35903">35903</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35901"></a>35901</td>
<td class="instruction">LD C,4</td>
<td class="comment-11" rowspan="1">Set bit 2 of <span class="register">C</span>: Willy is moving left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35903"></a>35903</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1">Copy the movement bits into <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35904"></a>35904</td>
<td class="instruction">AND 21</td>
<td class="comment-11" rowspan="1">Keep only bits 0, 2 and 4 (the 'right' bits)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35906"></a>35906</td>
<td class="instruction">CP 21</td>
<td class="comment-11" rowspan="1">Are any of these bits reset?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35908"></a>35908</td>
<td class="instruction">JR Z,<a class="link" href="35805.html#35912">35912</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35910"></a>35910</td>
<td class="instruction">SET 3,C</td>
<td class="comment-11" rowspan="1">Set bit 3 of <span class="register">C</span>: Willy is moving right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35912"></a>35912</td>
<td class="instruction">LD A,(32874)</td>
<td class="comment-11" rowspan="1">Pick up Willy's direction and movement flags from <a class="link" href="32874.html">32874</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35915"></a>35915</td>
<td class="instruction">ADD A,C</td>
<td class="comment-11" rowspan="5">Point <span class="register">HL</span> at the entry in the left-right movement table at <a class="link" href="33800.html">33800</a> that corresponds to the direction Willy is facing, and the direction in which he is being moved or trying to move</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35916"></a>35916</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35917"></a>35917</td>
<td class="instruction">LD B,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35919"></a>35919</td>
<td class="instruction">LD HL,33800</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35922"></a>35922</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35923"></a>35923</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="2">Update Willy's direction and movement flags at <a class="link" href="32874.html">32874</a> with the entry from the left-right movement table</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35924"></a>35924</td>
<td class="instruction">LD (32874),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="35927"></a>
<div class="comments">
<div class="paragraph">
That is left-right movement taken care of. Now check the jump keys.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35927"></a>35927</td>
<td class="instruction">LD BC,32510</td>
<td class="comment-11" rowspan="2">Read keys SHIFT-Z-X-C-V and B-N-M-SS-SPACE</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35930"></a>35930</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35932"></a>35932</td>
<td class="instruction">AND 31</td>
<td class="comment-11" rowspan="2">Are any of these keys being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35934"></a>35934</td>
<td class="instruction">CP 31</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35936"></a>35936</td>
<td class="instruction">JR NZ,<a class="link" href="35805.html#35963">35963</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35938"></a>35938</td>
<td class="instruction">LD B,239</td>
<td class="comment-11" rowspan="2">Read keys 0-9-8-7-6 into bits 0-4 of <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35940"></a>35940</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35942"></a>35942</td>
<td class="instruction">AND 9</td>
<td class="comment-11" rowspan="1">Keep only bits 0 (the '0' key) and 3 (the '7' key)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35944"></a>35944</td>
<td class="instruction">CP 9</td>
<td class="comment-11" rowspan="1">Is '0' or '7' being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35946"></a>35946</td>
<td class="instruction">JR NZ,<a class="link" href="35805.html#35963">35963</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35948"></a>35948</td>
<td class="instruction">LD A,(33881)</td>
<td class="comment-11" rowspan="1">Collect the Kempston joystick indicator from <a class="link" href="33881.html">33881</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35951"></a>35951</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Is the joystick connected?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35952"></a>35952</td>
<td class="instruction">JR Z,<a class="link" href="35805.html#35971">35971</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35954"></a>35954</td>
<td class="instruction">LD BC,31</td>
<td class="comment-11" rowspan="2">Collect input from the joystick</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35957"></a>35957</td>
<td class="instruction">IN A,(C)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35959"></a>35959</td>
<td class="instruction">BIT 4,A</td>
<td class="comment-11" rowspan="1">Is the fire button being pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35961"></a>35961</td>
<td class="instruction">JR Z,<a class="link" href="35805.html#35971">35971</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="35963"></a>
<div class="comments">
<div class="paragraph">
A jump key or the fire button is being pressed. Time to make Willy jump.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35963"></a>35963</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Initialise the jumping animation counter at <a class="link" href="32878.html">32878</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35964"></a>35964</td>
<td class="instruction">LD (32878),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35967"></a>35967</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="2">Set the airborne status indicator at <a class="link" href="32875.html">32875</a> to 1: Willy is jumping</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35968"></a>35968</td>
<td class="instruction">LD (32875),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="35971"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="35515.html">35515</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35971"></a>35971</td>
<td class="instruction">LD A,(32874)</td>
<td class="comment-11" rowspan="1">Pick up Willy's direction and movement flags from <a class="link" href="32874.html">32874</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35974"></a>35974</td>
<td class="instruction">AND 2</td>
<td class="comment-11" rowspan="1">Is Willy moving?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35976"></a>35976</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35977"></a>35977</td>
<td class="instruction">LD A,(32874)</td>
<td class="comment-11" rowspan="1">Pick up Willy's direction and movement flags from <a class="link" href="32874.html">32874</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35980"></a>35980</td>
<td class="instruction">AND 1</td>
<td class="comment-11" rowspan="1">Is Willy facing right?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35982"></a>35982</td>
<td class="instruction">JP Z,<a class="link" href="35805.html#36042">36042</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="35985"></a>
<div class="comments">
<div class="paragraph">
Willy is moving left.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35985"></a>35985</td>
<td class="instruction">LD A,(32873)</td>
<td class="comment-11" rowspan="1">Pick up Willy's animation frame from <a class="link" href="32873.html">32873</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35988"></a>35988</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Is it 0?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35989"></a>35989</td>
<td class="instruction">JR Z,<a class="link" href="35805.html#35996">35996</a></td>
<td class="comment-11" rowspan="1">If so, jump to move Willy's sprite left across a cell boundary</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35991"></a>35991</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="2">Decrement Willy's animation frame at <a class="link" href="32873.html">32873</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35992"></a>35992</td>
<td class="instruction">LD (32873),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35995"></a>35995</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="35996"></a>
<div class="comments">
<div class="paragraph">
Willy's sprite is moving left across a cell boundary. In the comments that follow, (x,y) refers to the coordinates of the top-left cell currently occupied by Willy's sprite.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="35996"></a>35996</td>
<td class="instruction">LD HL,(32876)</td>
<td class="comment-11" rowspan="1">Collect Willy's attribute buffer coordinates from <a class="link" href="32876.html">32876</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="35999"></a>35999</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="3">Point <span class="register">HL</span> at the cell at (x-1,y+1)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36000"></a>36000</td>
<td class="instruction">LD DE,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36003"></a>36003</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36004"></a>36004</td>
<td class="instruction">LD A,(32827)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the wall tile for the current cavern from <a class="link" href="32800.html#32827">32827</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36007"></a>36007</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is there a wall tile in the cell pointed to by <span class="register">HL</span>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36008"></a>36008</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so without moving Willy (his path is blocked)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36009"></a>36009</td>
<td class="instruction">LD A,(32872)</td>
<td class="comment-11" rowspan="1">Pick up Willy's pixel y-coordinate from <a class="link" href="32872.html">32872</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36012"></a>36012</td>
<td class="instruction">AND 15</td>
<td class="comment-11" rowspan="1">Does Willy's sprite currently occupy only two rows of cells?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36014"></a>36014</td>
<td class="instruction">JR Z,<a class="link" href="35805.html#36025">36025</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36016"></a>36016</td>
<td class="instruction">LD A,(32827)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the wall tile for the current cavern from <a class="link" href="32800.html#32827">32827</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36019"></a>36019</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the cell at (x-1,y+2)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36020"></a>36020</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is there a wall tile in the cell pointed to by <span class="register">HL</span>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36021"></a>36021</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so without moving Willy (his path is blocked)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36022"></a>36022</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Clear the carry flag for subtraction</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36023"></a>36023</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the cell at (x-1,y+1)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36025"></a>36025</td>
<td class="instruction">LD A,(32827)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the wall tile for the current cavern from <a class="link" href="32800.html#32827">32827</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36028"></a>36028</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Clear the carry flag for subtraction</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36029"></a>36029</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the cell at (x-1,y)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36031"></a>36031</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is there a wall tile in the cell pointed to by <span class="register">HL</span>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36032"></a>36032</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so without moving Willy (his path is blocked)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36033"></a>36033</td>
<td class="instruction">LD (32876),HL</td>
<td class="comment-11" rowspan="1">Save Willy's new attribute buffer coordinates (in <span class="register">HL</span>) at <a class="link" href="32876.html">32876</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36036"></a>36036</td>
<td class="instruction">LD A,3</td>
<td class="comment-11" rowspan="2">Change Willy's animation frame at <a class="link" href="32873.html">32873</a> from 0 to 3</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36038"></a>36038</td>
<td class="instruction">LD (32873),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36041"></a>36041</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36042"></a>
<div class="comments">
<div class="paragraph">
Willy is moving right.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36042"></a>36042</td>
<td class="instruction">LD A,(32873)</td>
<td class="comment-11" rowspan="1">Pick up Willy's animation frame from <a class="link" href="32873.html">32873</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36045"></a>36045</td>
<td class="instruction">CP 3</td>
<td class="comment-11" rowspan="1">Is it 3?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36047"></a>36047</td>
<td class="instruction">JR Z,<a class="link" href="35805.html#36054">36054</a></td>
<td class="comment-11" rowspan="1">If so, jump to move Willy's sprite right across a cell boundary</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36049"></a>36049</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="2">Increment Willy's animation frame at <a class="link" href="32873.html">32873</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36050"></a>36050</td>
<td class="instruction">LD (32873),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36053"></a>36053</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36054"></a>
<div class="comments">
<div class="paragraph">
Willy's sprite is moving right across a cell boundary. In the comments that follow, (x,y) refers to the coordinates of the top-left cell currently occupied by Willy's sprite.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36054"></a>36054</td>
<td class="instruction">LD HL,(32876)</td>
<td class="comment-11" rowspan="1">Collect Willy's attribute buffer coordinates from <a class="link" href="32876.html">32876</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36057"></a>36057</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="2">Point <span class="register">HL</span> at the cell at (x+2,y)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36058"></a>36058</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36059"></a>36059</td>
<td class="instruction">LD DE,32</td>
<td class="comment-11" rowspan="1">Prepare <span class="register">DE</span> for addition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36062"></a>36062</td>
<td class="instruction">LD A,(32827)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the wall tile for the current cavern from <a class="link" href="32800.html#32827">32827</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36065"></a>36065</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the cell at (x+2,y+1)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36066"></a>36066</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is there a wall tile in the cell pointed to by <span class="register">HL</span>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36067"></a>36067</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so without moving Willy (his path is blocked)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36068"></a>36068</td>
<td class="instruction">LD A,(32872)</td>
<td class="comment-11" rowspan="1">Pick up Willy's pixel y-coordinate from <a class="link" href="32872.html">32872</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36071"></a>36071</td>
<td class="instruction">AND 15</td>
<td class="comment-11" rowspan="1">Does Willy's sprite currently occupy only two rows of cells?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36073"></a>36073</td>
<td class="instruction">JR Z,<a class="link" href="35805.html#36084">36084</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36075"></a>36075</td>
<td class="instruction">LD A,(32827)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the wall tile for the current cavern from <a class="link" href="32800.html#32827">32827</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36078"></a>36078</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the cell at (x+2,y+2)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36079"></a>36079</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is there a wall tile in the cell pointed to by <span class="register">HL</span>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36080"></a>36080</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so without moving Willy (his path is blocked)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36081"></a>36081</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Clear the carry flag for subtraction</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36082"></a>36082</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the cell at (x+2,y+1)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36084"></a>36084</td>
<td class="instruction">LD A,(32827)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the wall tile for the current cavern from <a class="link" href="32800.html#32827">32827</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36087"></a>36087</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Clear the carry flag for subtraction</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36088"></a>36088</td>
<td class="instruction">SBC HL,DE</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the cell at (x+2,y)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36090"></a>36090</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is there a wall tile in the cell pointed to by <span class="register">HL</span>?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36091"></a>36091</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so without moving Willy (his path is blocked)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36092"></a>36092</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the cell at (x+1,y)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36093"></a>36093</td>
<td class="instruction">LD (32876),HL</td>
<td class="comment-11" rowspan="1">Save Willy's new attribute buffer coordinates (in <span class="register">HL</span>) at <a class="link" href="32876.html">32876</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36096"></a>36096</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Change Willy's animation frame at <a class="link" href="32873.html">32873</a> from 3 to 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36097"></a>36097</td>
<td class="instruction">LD (32873),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36100"></a>36100</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="35770.html">35770</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#35805">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="36101.html">36101</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Manic Miner RAM disassembly 20150328</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd (Manic Miner). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>