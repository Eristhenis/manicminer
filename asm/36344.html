<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Manic Miner: Routine at 36344</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="36266.html">36266</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#36344">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="36469.html">36469</a></span></td>
</tr>
</table>
<div class="description">36344: Move and draw Eugene in Eugene's Lair</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="34574.html">34574</a>. First we move Eugene up or down, or change his direction.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36344"></a>36344</td>
<td class="instruction">LD A,(32884)</td>
<td class="comment-11" rowspan="1">Pick up the attribute of the last item drawn from <a class="link" href="32884.html">32884</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36347"></a>36347</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Have all the items been collected?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36348"></a>36348</td>
<td class="instruction">JR Z,<a class="link" href="36344.html#36367">36367</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36350"></a>36350</td>
<td class="instruction">LD A,(32987)</td>
<td class="comment-11" rowspan="1">Pick up Eugene's direction from <a class="link" href="32987.html">32987</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36353"></a>36353</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Is Eugene moving downwards?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36354"></a>36354</td>
<td class="instruction">JR Z,<a class="link" href="36344.html#36367">36367</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36356"></a>36356</td>
<td class="instruction">LD A,(32988)</td>
<td class="comment-11" rowspan="1">Pick up Eugene's pixel y-coordinate from <a class="link" href="32988.html">32988</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36359"></a>36359</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="1">Decrement it (moving Eugene up)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36360"></a>36360</td>
<td class="instruction">JR Z,<a class="link" href="36344.html#36380">36380</a></td>
<td class="comment-11" rowspan="1">Jump if Eugene has reached the top of the cavern</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36362"></a>36362</td>
<td class="instruction">LD (32988),A</td>
<td class="comment-11" rowspan="1">Update Eugene's pixel y-coordinate at <a class="link" href="32988.html">32988</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36365"></a>36365</td>
<td class="instruction">JR <a class="link" href="36344.html#36388">36388</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36367"></a>36367</td>
<td class="instruction">LD A,(32988)</td>
<td class="comment-11" rowspan="1">Pick up Eugene's pixel y-coordinate from <a class="link" href="32988.html">32988</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36370"></a>36370</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1">Increment it (moving Eugene down)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36371"></a>36371</td>
<td class="instruction">CP 88</td>
<td class="comment-11" rowspan="1">Has Eugene reached the portal yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36373"></a>36373</td>
<td class="instruction">JR Z,<a class="link" href="36344.html#36380">36380</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36375"></a>36375</td>
<td class="instruction">LD (32988),A</td>
<td class="comment-11" rowspan="1">Update Eugene's pixel y-coordinate at <a class="link" href="32988.html">32988</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36378"></a>36378</td>
<td class="instruction">JR <a class="link" href="36344.html#36388">36388</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36380"></a>36380</td>
<td class="instruction">LD A,(32987)</td>
<td class="comment-11" rowspan="3">Toggle Eugene's direction at <a class="link" href="32987.html">32987</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36383"></a>36383</td>
<td class="instruction">XOR 1</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36385"></a>36385</td>
<td class="instruction">LD (32987),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36388"></a>
<div class="comments">
<div class="paragraph">
Now that Eugene's movement has been dealt with, it's time to draw him.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36388"></a>36388</td>
<td class="instruction">LD A,(32988)</td>
<td class="comment-11" rowspan="1">Pick up Eugene's pixel y-coordinate from <a class="link" href="32988.html">32988</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36391"></a>36391</td>
<td class="instruction">AND 127</td>
<td class="comment-11" rowspan="4">Point <span class="register">DE</span> at the entry in the screen buffer address lookup table at <a class="link" href="33536.html">33536</a> that corresponds to Eugene's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36393"></a>36393</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36394"></a>36394</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36395"></a>36395</td>
<td class="instruction">LD D,131</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36397"></a>36397</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="6">Point <span class="register">HL</span> at the address of Eugene's location in the screen buffer at <a class="link" href="24576.html">24576</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36398"></a>36398</td>
<td class="instruction">OR 15</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36400"></a>36400</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36401"></a>36401</td>
<td class="instruction">INC DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36402"></a>36402</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36403"></a>36403</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36404"></a>36404</td>
<td class="instruction">LD DE,32992</td>
<td class="comment-11" rowspan="3">Draw Eugene to the screen buffer at <a class="link" href="24576.html">24576</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36407"></a>36407</td>
<td class="instruction">LD C,1</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36409"></a>36409</td>
<td class="instruction">CALL <a class="link" href="36852.html">36852</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36412"></a>36412</td>
<td class="instruction">JP NZ,<a class="link" href="36101.html#36102">36102</a></td>
<td class="comment-11" rowspan="1">Kill Willy if Eugene collided with him</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36415"></a>36415</td>
<td class="instruction">LD A,(32988)</td>
<td class="comment-11" rowspan="1">Pick up Eugene's pixel y-coordinate from <a class="link" href="32988.html">32988</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36418"></a>36418</td>
<td class="instruction">AND 120</td>
<td class="comment-11" rowspan="9">Point <span class="register">HL</span> at the address of Eugene's location in the attribute buffer at <a class="link" href="23552.html">23552</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36420"></a>36420</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36421"></a>36421</td>
<td class="instruction">OR 7</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36423"></a>36423</td>
<td class="instruction">SCF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36424"></a>36424</td>
<td class="instruction">RL A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36426"></a>36426</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36427"></a>36427</td>
<td class="instruction">LD A,0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36429"></a>36429</td>
<td class="instruction">ADC A,92</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36431"></a>36431</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36432"></a>36432</td>
<td class="instruction">LD A,(32884)</td>
<td class="comment-11" rowspan="1">Pick up the attribute of the last item drawn from <a class="link" href="32884.html">32884</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36435"></a>36435</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">Set the zero flag if all the items have been collected</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36436"></a>36436</td>
<td class="instruction">LD A,7</td>
<td class="comment-11" rowspan="1">Assume we will draw Eugene with white INK</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36438"></a>36438</td>
<td class="instruction">JR NZ,<a class="link" href="36344.html#36447">36447</a></td>
<td class="comment-11" rowspan="1">Jump if there are items remaining to be collected</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36440"></a>36440</td>
<td class="instruction">LD A,(32957)</td>
<td class="comment-11" rowspan="1">Pick up the value of the game clock at <a class="link" href="32957.html">32957</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36443"></a>36443</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="3">Move bits 2-4 into bits 0-2 and clear the other bits; this value (which decreases by one on each pass through the main loop) will be Eugene's INK colour</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36444"></a>36444</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36445"></a>36445</td>
<td class="instruction">AND 7</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36447"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a class="link" href="36469.html">36469</a> (to set the attributes for a Skylab), <a class="link" href="36593.html">36593</a> (to set the attributes for a vertical guardian) and <a class="link" href="37173.html">37173</a> (to set the attributes for the Kong Beast).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36447"></a>36447</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Save the INK colour in the attribute buffer temporarily</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36448"></a>36448</td>
<td class="instruction">LD A,(32800)</td>
<td class="comment-11" rowspan="1">Pick up the attribute byte of the background tile for the current cavern from <a class="link" href="32800.html">32800</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36451"></a>36451</td>
<td class="instruction">AND 248</td>
<td class="comment-11" rowspan="2">Combine its PAPER colour with the chosen INK colour</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36453"></a>36453</td>
<td class="instruction">OR (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36454"></a>36454</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Set the attribute byte for the top-left cell of the sprite in the attribute buffer at <a class="link" href="23552.html">23552</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36455"></a>36455</td>
<td class="instruction">LD DE,31</td>
<td class="comment-11" rowspan="1">Prepare <span class="register">DE</span> for addition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36458"></a>36458</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="2">Set the attribute byte for the top-right cell of the sprite in the attribute buffer at <a class="link" href="23552.html">23552</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36459"></a>36459</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36460"></a>36460</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="2">Set the attribute byte for the middle-left cell of the sprite in the attribute buffer at <a class="link" href="23552.html">23552</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36461"></a>36461</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36462"></a>36462</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="2">Set the attribute byte for the middle-right cell of the sprite in the attribute buffer at <a class="link" href="23552.html">23552</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36463"></a>36463</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36464"></a>36464</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-11" rowspan="2">Set the attribute byte for the bottom-left cell of the sprite in the attribute buffer at <a class="link" href="23552.html">23552</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36465"></a>36465</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36466"></a>36466</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="2">Set the attribute byte for the bottom-right cell of the sprite in the attribute buffer at <a class="link" href="23552.html">23552</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36467"></a>36467</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36468"></a>36468</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="36266.html">36266</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#36344">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="36469.html">36469</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Manic Miner RAM disassembly 20141004</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd (Manic Miner). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.1.1.</div>
</div>
</body>
</html>