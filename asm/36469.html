<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Manic Miner: Routine at 36469</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="36344.html">36344</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#36469">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="36593.html">36593</a></span></td>
</tr>
</table>
<div class="description">36469: Move and draw the Skylabs in Skylab Landing Bay</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="34574.html">34574</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36469"></a>36469</td>
<td class="instruction">LD IY,32989</td>
<td class="comment-11" rowspan="1">Point <span class="register">IY</span> at the first byte of the first vertical guardian definition at <a class="link" href="32989.html">32989</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36473"></a>
<div class="comments">
<div class="paragraph">
The Skylab-moving loop begins here.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36473"></a>36473</td>
<td class="instruction">LD A,(IY+0)</td>
<td class="comment-11" rowspan="1">Pick up the first byte of the guardian definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36476"></a>36476</td>
<td class="instruction">CP 255</td>
<td class="comment-11" rowspan="1">Have we dealt with all the Skylabs yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36478"></a>36478</td>
<td class="instruction">JP Z,<a class="link" href="34574.html#34719">34719</a></td>
<td class="comment-11" rowspan="1">If so, re-enter the main loop</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36481"></a>36481</td>
<td class="instruction">LD A,(IY+2)</td>
<td class="comment-11" rowspan="1">Pick up the Skylab's pixel y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36484"></a>36484</td>
<td class="instruction">CP (IY+6)</td>
<td class="comment-11" rowspan="1">Has it reached its crash site yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36487"></a>36487</td>
<td class="instruction">JR NC,<a class="link" href="36469.html#36497">36497</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36489"></a>36489</td>
<td class="instruction">ADD A,(IY+4)</td>
<td class="comment-11" rowspan="2">Increment the Skylab's y-coordinate (moving it downwards)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36492"></a>36492</td>
<td class="instruction">LD (IY+2),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36495"></a>36495</td>
<td class="instruction">JR <a class="link" href="36469.html#36527">36527</a></td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36497"></a>
<div class="comments">
<div class="paragraph">
The Skylab has reached its crash site. Start or continue its disintegration.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36497"></a>36497</td>
<td class="instruction">INC (IY+1)</td>
<td class="comment-11" rowspan="1">Increment the animation frame</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36500"></a>36500</td>
<td class="instruction">LD A,(IY+1)</td>
<td class="comment-11" rowspan="1">Pick up the animation frame</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36503"></a>36503</td>
<td class="instruction">CP 8</td>
<td class="comment-11" rowspan="1">Has the Skylab completely disintegrated yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36505"></a>36505</td>
<td class="instruction">JR NZ,<a class="link" href="36469.html#36527">36527</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36507"></a>36507</td>
<td class="instruction">LD A,(IY+5)</td>
<td class="comment-11" rowspan="2">Reset the Skylab's pixel y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36510"></a>36510</td>
<td class="instruction">LD (IY+2),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36513"></a>36513</td>
<td class="instruction">LD A,(IY+3)</td>
<td class="comment-11" rowspan="4">Add 8 to the Skylab's x-coordinate (wrapping around at the right side of the screen)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36516"></a>36516</td>
<td class="instruction">ADD A,8</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36518"></a>36518</td>
<td class="instruction">AND 31</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36520"></a>36520</td>
<td class="instruction">LD (IY+3),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36523"></a>36523</td>
<td class="instruction">LD (IY+1),0</td>
<td class="comment-11" rowspan="1">Reset the animation frame to 0</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36527"></a>
<div class="comments">
<div class="paragraph">
Now that the Skylab's movement has been dealt with, time to draw it.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="36527"></a>36527</td>
<td class="instruction">LD E,(IY+2)</td>
<td class="comment-11" rowspan="1">Pick up the Skylab's pixel y-coordinate in <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36530"></a>36530</td>
<td class="instruction">RLC E</td>
<td class="comment-11" rowspan="2">Point <span class="register">DE</span> at the entry in the screen buffer address lookup table at <a class="link" href="33536.html">33536</a> that corresponds to the Skylab's pixel y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36532"></a>36532</td>
<td class="instruction">LD D,131</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36534"></a>36534</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="6">Point <span class="register">HL</span> at the address of the Skylab's location in the screen buffer at <a class="link" href="24576.html">24576</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36535"></a>36535</td>
<td class="instruction">ADD A,(IY+3)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36538"></a>36538</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36539"></a>36539</td>
<td class="instruction">INC DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36540"></a>36540</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36541"></a>36541</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36542"></a>36542</td>
<td class="instruction">LD A,(IY+1)</td>
<td class="comment-11" rowspan="1">Pick up the animation frame (0-7)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36545"></a>36545</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="3">Multiply it by 32</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36546"></a>36546</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36547"></a>36547</td>
<td class="instruction">RRCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36548"></a>36548</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="2">Point <span class="register">DE</span> at the graphic data for the corresponding Skylab sprite (at <a class="link" href="33024.html">33024</a>+<span class="register">A</span>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36549"></a>36549</td>
<td class="instruction">LD D,129</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36551"></a>36551</td>
<td class="instruction">LD C,1</td>
<td class="comment-11" rowspan="2">Draw the Skylab to the screen buffer at <a class="link" href="24576.html">24576</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36553"></a>36553</td>
<td class="instruction">CALL <a class="link" href="36852.html">36852</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36556"></a>36556</td>
<td class="instruction">JP NZ,<a class="link" href="36101.html#36103">36103</a></td>
<td class="comment-11" rowspan="1">Kill Willy if the Skylab collided with him</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36559"></a>36559</td>
<td class="instruction">LD A,(IY+2)</td>
<td class="comment-11" rowspan="12">Point <span class="register">HL</span> at the address of the Skylab's location in the attribute buffer at <a class="link" href="23552.html">23552</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36562"></a>36562</td>
<td class="instruction">AND 64</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36564"></a>36564</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36565"></a>36565</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36566"></a>36566</td>
<td class="instruction">ADD A,92</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36568"></a>36568</td>
<td class="instruction">LD H,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36569"></a>36569</td>
<td class="instruction">LD A,(IY+2)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36572"></a>36572</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36573"></a>36573</td>
<td class="instruction">RLCA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36574"></a>36574</td>
<td class="instruction">AND 224</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36576"></a>36576</td>
<td class="instruction">OR (IY+3)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36579"></a>36579</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36580"></a>36580</td>
<td class="instruction">LD A,(IY+0)</td>
<td class="comment-11" rowspan="1">Pick up the Skylab's attribute byte</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36583"></a>36583</td>
<td class="instruction">CALL <a class="link" href="36344.html#36447">36447</a></td>
<td class="comment-11" rowspan="1">Set the attribute bytes for the Skylab</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="36586"></a>
<div class="comments">
<div class="paragraph">
The current guardian definition has been dealt with. Time for the next one.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36586"></a>36586</td>
<td class="instruction">LD DE,7</td>
<td class="comment-11" rowspan="2">Point <span class="register">IY</span> at the first byte of the next vertical guardian definition</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36589"></a>36589</td>
<td class="instruction">ADD IY,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="36591"></a>36591</td>
<td class="instruction">JR <a class="link" href="36469.html#36473">36473</a></td>
<td class="comment-11" rowspan="1">Jump back to deal with the next Skylab</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="36344.html">36344</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#36469">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="36593.html">36593</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Manic Miner RAM disassembly 20141004</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd (Manic Miner). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.1.1.</div>
</div>
</body>
</html>