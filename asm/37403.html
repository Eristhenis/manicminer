<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Manic Miner: Routine at 37403</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../style.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Manic Miner" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="37173.html">37173</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#37403">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="37434.html">37434</a></span></td>
</tr>
</table>
<div class="description">37403: Flip a switch in a Kong Beast cavern if Willy is touching it</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="37173.html">37173</a>. Returns with the zero flag set if Willy flips the switch.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Address of the switch's location in the attribute buffer at <a class="link" href="23552.html">23552</a></td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="37403"></a>37403</td>
<td class="instruction">LD A,(32876)</td>
<td class="comment-11" rowspan="1">Pick up the LSB of the address of Willy's location in the attribute buffer at <a class="link" href="23552.html">23552</a> from <a class="link" href="32876.html">32876</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37406"></a>37406</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="3">Is it equal to or one less than the LSB of the address of the switch's location?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37407"></a>37407</td>
<td class="instruction">AND 254</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37409"></a>37409</td>
<td class="instruction">CP L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37410"></a>37410</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return (with the zero flag reset) if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37411"></a>37411</td>
<td class="instruction">LD A,(32877)</td>
<td class="comment-11" rowspan="1">Pick up the MSB of the address of Willy's location in the attribute buffer at <a class="link" href="23552.html">23552</a> from <a class="link" href="32876.html">32877</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37414"></a>37414</td>
<td class="instruction">CP H</td>
<td class="comment-11" rowspan="1">Does it match the MSB of the address of the switch's location?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37415"></a>37415</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return (with the zero flag reset) if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37416"></a>37416</td>
<td class="instruction">LD A,(32869)</td>
<td class="comment-11" rowspan="1">Pick up the sixth byte of the graphic data for the switch tile from <a class="link" href="32800.html#32863">32869</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37419"></a>37419</td>
<td class="instruction">LD H,117</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the sixth row of pixels of the switch tile in the screen buffer at <a class="link" href="28672.html">28672</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37421"></a>37421</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Has the switch already been flipped?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37422"></a>37422</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return (with the zero flag reset) if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="37423"></a>
<div class="comments">
<div class="paragraph">
Willy is flipping the switch.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37423"></a>37423</td>
<td class="instruction">LD (HL),8</td>
<td class="comment-11" rowspan="5">Update the sixth, seventh and eighth rows of pixels of the switch tile in the screen buffer at <a class="link" href="28672.html">28672</a> to make it appear flipped</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37425"></a>37425</td>
<td class="instruction">INC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37426"></a>37426</td>
<td class="instruction">LD (HL),6</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37428"></a>37428</td>
<td class="instruction">INC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37429"></a>37429</td>
<td class="instruction">LD (HL),6</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37431"></a>37431</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1">Set the zero flag: Willy has flipped the switch</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37432"></a>37432</td>
<td class="instruction">OR A</td>
<td class="comment-11" rowspan="1">This instruction is redundant</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="37433"></a>37433</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="37173.html">37173</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#37403">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="37434.html">37434</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Manic Miner RAM disassembly 20150328</div>
<div class="copyright">&#169; 1983 Bug-Byte Ltd (Manic Miner). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>